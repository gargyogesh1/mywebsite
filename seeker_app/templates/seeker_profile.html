{% extends 'common.html' %}
{% block headCss %}
  <style>
    .job-profile-section {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #f5f5f5;
      display: flex;
      min-height: 100vh;
      gap: 20px;
      padding: 20px;
    }
    
    .left-column {
      flex: 4;
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      height: fit-content;
    }
    
    .profile-card {
      margin-bottom: 20px;
    }
    
    .profile-header {
      display: flex;
      gap: 15px;
      align-items: center;
    }
    
    .avatar {
      background: #007bff;
      color: #fff;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      font-weight: bold;
    }
    
    .update-warning {
      background: #fff3cd;
      padding: 10px;
      border: 1px solid #ffeeba;
      border-radius: 6px;
      font-size: 14px;
      margin: 10px 0;
    }
    
    .profile-score {
      background: #fafafa;
      padding: 15px;
      border-radius: 8px;
      border: 1px solid #eee;
    }
    
    .score-bar {
      background: #ddd;
      height: 10px;
      border-radius: 5px;
      margin: 8px 0;
    }
    
    .score-fill {
      background: #28a745;
      height: 100%;
      border-radius: 5px;
    }
    
    /* Right Column */
    .right-column {
      flex: 8;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    
    /* Navbar inside Right */
    .section-navbar {
      background: #fff;
      padding: 10px 15px;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      /*position: sticky;*/
      top: 0;
      z-index: 10;
    }
    
    .section-navbar ul {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      list-style: none;
      margin: 0;
      padding: 0;
    }
    
    .section-navbar a {
      text-decoration: none;
      color: #007bff;
      font-weight: 500;
    }
    
    .section-navbar a:hover {
      text-decoration: underline;
    }
    
    /* Cards */
    .card {
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      margin: 10px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }
    
    .tags span {
      background: #e9ecef;
      padding: 5px 10px;
      border-radius: 6px;
      margin: 5px;
      display: inline-block;
      font-size: 13px;
    }
    
    @media (max-width: 900px) {
      body {
        flex-direction: column;
      }
    
      .left-column,
      .right-column {
        flex: 100%;
        width: 90%;
      }
    
      .section-navbar ul {
        flex-direction: column;
        gap: 8px;
      }
    }
    
    /* Styling for each form entry */
    
    /* Highlight filled forms */
    .profile-entry-filled {
      border-left: 5px solid #007bff; /* A nice blue highlight */
    }
    
    /* Style for labels */
    label {
      display: block;
      margin-bottom: 0.5rem;
      color: #495057;
      font-weight: 600;
    }
    
    /* Style for all input fields and selects */
    input[type='text'],
    input[type='date'],
    input[type='number'],
    select {
      width: 100%;
      padding: 10px;
      margin-bottom: 1.25rem;
      border: 1px solid #ced4da;
      border-radius: 6px;
      box-sizing: border-box; /* Ensures padding and border are included in the element's total width and height */
      font-size: 1rem;
      color: #495057;
      transition: border-color 0.3s ease, box-shadow 0.3s ease;
    }
    
    /* Add focus styles to inputs */
    input:focus,
    select:focus {
      border-color: #80bdff;
      outline: none;
      box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
    }
    
    /* Style the buttons */
    button {
      background-color: #3e8da8; /* Red for delete button */
      color: #fff;
      border: none;
      padding: 10px 15px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 1rem;
      transition: background-color 0.3s ease;
    }
    
    button:hover {
      background-color: #5acdf4;
    }
    
    /* Style the horizontal rule for separation */
    hr {
      border: 0;
      height: 1px;
      background-color: #e0e0e0;
      margin-top: 1.5rem;
      margin-bottom: 1.5rem;
    }
  </style>
{% endblock %}

{% block content %}
  <section class="job-profile-section">
    <div class="left-column">
      <div class="profile-card">
        <div class="profile-header">
          <div class="avatar">{{ seeker.full_name }}</div>
          <div>
            <h2>{{ seeker.full_name }}</h2>
            <p class="subtitle">{{ seeker.profile_summary }}</p>
            {% comment %} <p class="subtext">
              Self-Employed Â· Feb 2022 - Mar 2024<br />Rohtak
            </p> {% endcomment %}
          </div>
        </div>
        <p>
          <strong>Total exp:</strong> 3 yrs 5 mos
        </p>
        <p>
          <strong>Notice period:</strong> Immediate
        </p>
        <div class="update-warning">âš  Profile is not visible to recruiter without the mandatory information</div>
        <div class="contact-info">
          <p>ðŸ“ž {{ seeker.mobile_number }}</p>
          <p>âœ‰ {{ seeker.email_id }}</p>
        </div>
      </div>

      <div class="profile-score">
        <h3>Profile Score</h3>
        <div class="score-bar">
          <div class="score-fill" style="width:46%"></div>
        </div>
        <p>46% completed</p>
        <ul>
          <li>LinkedIn</li>
          <li>Resume</li>
          <li>Salary</li>
          <li>Profile Picture</li>
          <li>Preferred Location</li>
        </ul>
      </div>
    </div>

    <!-- Right Column -->
    <div class="right-column">
      <!-- Navbar at Top -->
      <nav class="section-navbar">
        <ul>
          <li>
            <a href="#update-profile">Update Profile</a>
          </li>
          <li>
            <a href="#profile-summary">Profile Summary</a>
          </li>
          <li>
            <a href="#skills">Skills</a>
          </li>
          <li>
            <a href="#education">Education</a>
          </li>
          <li>
            <a href="#languages">Languages</a>
          </li>
          <li>
            <a href="#internships">Internships</a>
          </li>
          <li>
            <a href="#projects">Projects</a>
          </li>
          <li>
            <a href="#accomplishments">Accomplishments</a>
          </li>
          <li>
            <a href="#exams">Competitive Exams</a>
          </li>
          <li>
            <a href="#employment">Employment</a>
          </li>
          <li>
            <a href="#achievements">Academic Achievements</a>
          </li>
          <li>
            <a href="#social-links">Social Links</a>
          </li>
        </ul>
      </nav>
      <form method="POST" enctype="multipart/form-data">
        {% csrf_token %}

        <!-- Cards -->
        <div class="card" id="update-profile">
          <h3>Update your profile instantly!</h3>
          <input type="file" class="upload-box" />
          <button class="upload-btn">Upload Resume</button>
        </div>

        <div class="card" id="profile-summary">
          <h3>Profile summary</h3>
          <p class="placeholder">Add your profile summary</p>
          <input class="p-1" name="summary" value="{{ seeker.profile_summary }}" placeholder="Write a brief profile summary" />
        </div>

        <div class="card" id="skills">
          <h3>Skills</h3>
          <div class="tags">
            {% for skill in skills_list %}
              <span>{{ skill }}</span>
            {% endfor %}
          </div>
        </div>

        <div class="card" id="education">
          <h3>Education</h3>
          <div id="education-container" class="pb-1">
            <button type="button" onclick="addFormEntry('education')">Add More Languages</button>
            <template id="education-entry">
              {% include 'form_templates/education_form.html' %}
            </template> {# We include the form here with no 'entry' object, so it renders as an empty form #}

            <div id="education-forms-container">
              {% for edu in educations %}
                {% include 'form_templates/education_form.html' with entry=edu %}
              {% endfor %}
            </div>
          </div>
        </div>

        <div class="card" id="languages">
          <h3>Languages</h3>
          <div id="language-container" class="pb-1">
            <button type="button" onclick="addFormEntry('language')">Add More Languages</button>
            <template id="language-entry">
              {% include 'form_templates/language_form.html' %}
            </template> {# We include the form here with no 'entry' object, so it renders as an empty form #}

            <div id="language-forms-container">
              {% for lang in languages %}
                {% include 'form_templates/language_form.html' with entry=lang %}
              {% endfor %}
            </div>
          </div>
        </div>

        <div class="card" id="internships">
          <h2>Internships Details</h2>

          <div id="internship-container" class="pb-4">
            <button type="button" onclick="addFormEntry('internship')">Add More internships</button>
            <template id="internship-entry">
              {% include 'form_templates/internship_form.html' %}
            </template> {# We include the form here with no 'entry' object, so it renders as an empty form #}

            <div id="internship-forms-container">
              {% for field in internships %}
                {% include 'form_templates/internship_form.html' with entry=field %}
              {% endfor %}
            </div>
          </div>
        </div>
      <div class="card" id="exams">


        <h2>Competitive Exams</h2>
        

         <div id="exam-container" class="pb-4">
          <button type="button" onclick="addFormEntry('exam')">Add More Exams</button>
          <template id="exam-entry">
            {% include 'form_templates/exam_form.html' %}
          </template> {# We include the form here with no 'entry' object, so it renders as an empty form #}

          <div id="exam-forms-container">
            {% for field in exams %}
              {% include 'form_templates/exam_form.html' with entry=field %}
            {% endfor %}
          </div>
        </div>
        
      </div>


       <div class="card" id="employments">
        <h2>Employment</h2>


         <div id="employment-container" class="pb-4">
          <button type="button" onclick="addFormEntry('employment')">Add More Employment</button>
          <template id="employment-entry">
            {% include 'form_templates/employment_form.html' %}
          </template> {# We include the form here with no 'entry' object, so it renders as an empty form #}

          <div id="employment-forms-container">
            {% for field in employments %}
              {% include 'form_templates/employment_form.html' with entry=field %}
            {% endfor %}
          </div>
        </div>


      </div>

      <div class="card" id="achievements">
        <h2>Academic Achievements</h2>

        <div id="achievement-container" class="pb-4">
          <button type="button" onclick="addFormEntry('achievement')">Add More Achievements</button>
          <template id="achievement-entry">
            {% include 'form_templates/achievement_form.html' %}
          </template> {# We include the form here with no 'entry' object, so it renders as an empty form #}

          <div id="achievement-forms-container">
            {% for field in achievements %}
              {% include 'form_templates/achievement_form.html' with entry=field %}
            {% endfor %}
          </div>
        </div>
      </div>

      <div class="card" id="projects">
        <h2>Projects</h2>

    <div id="project-container" class="pb-4">
          <button type="button" onclick="addFormEntry('project')">Add More projects</button>
          <template id="project-entry">
            {% include 'form_templates/project_form.html' %}
          </template> {# We include the form here with no 'entry' object, so it renders as an empty form #}

          <div id="project-forms-container">
            {% for field in projects %}
              {% include 'form_templates/project_form.html' with entry=field %}
            {% endfor %}
          </div>
        </div>

      </div>

    <div class="card" id="social-links">
      <h3>Social Links</h3>
      <a href="https://github.com/gargyogesh1" target="_blank">GitHub Profile</a>
    </div>

        <button type="submit" class="submit-btn">Submit Profile</button>
      </form>
    </div>
  </section>

 

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const scoreFill = document.querySelector('.score-fill')
      let width = 0
      const target = 46
      const interval = setInterval(() => {
        if (width >= target) {
          clearInterval(interval)
        } else {
          width++
          scoreFill.style.width = width + '%'
        }
      }, 20)
    })
    
    function addFormEntry(sectionPrefix) {
      // Looks for a template with an ID like "education-entry"
      const template = document.getElementById(`${sectionPrefix}-entry`)
      const container = document.getElementById(`${sectionPrefix}-forms-container`)
    
      if (template && container) {
        const clone = template.content.cloneNode(true)
        container.appendChild(clone)
      }
    }
    
    function deleteFormEntry(button, sectionPrefix, entryId = null) {
      const entryElement = button.closest('.form-entry')
    
      if (!entryElement) return
    
      if (confirm('Are you sure you want to delete this item?')) {
        // If an entryId is provided, it's an existing item in the database.
        if (entryId) {
          const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value
    
          // Assumes a URL pattern like /your-app/delete_section/123/
          fetch(`/seeker_app/delete_field/${sectionPrefix}/${entryId}/`, {
            method: 'POST',
            headers: {
              'X-CSRFToken': csrfToken,
              'Content-Type': 'application/json'
            }
          })
            .then((response) => response.json())
            .then((data) => {
              if (data.status === 'ok') {
                entryElement.remove()
              } else {
                alert(`Failed to delete: ${data.message || 'Unknown error'}`)
              }
            })
            .catch((error) => {
              console.error('Error:', error)
              alert('An error occurred while trying to delete.')
            })
        } else {
          // If no entryId, it's a new, unsaved item. Just remove it from the DOM.
          entryElement.remove()
        }
      }
    }
    // Smooth Scrolling for Navigation Links
    document.querySelectorAll('.quick-links a').forEach((link) => {
      link.addEventListener('click', function (e) {
        e.preventDefault()
        const section = document.querySelector(this.getAttribute('href'))
        section.scrollIntoView({ behavior: 'smooth' })
      })
    })
    
    window.addEventListener('scroll', () => {
      const scrollTop = document.documentElement.scrollTop
      const scrollHeight = document.documentElement.scrollHeight - document.documentElement.clientHeight
      const progress = (scrollTop / scrollHeight) * 100
      document.getElementById('progress-bar').style.width = progress + '%'
    })
  </script>
{% endblock %}
