
{% extends "company_common.html" %}
{% block content %}

{% comment %} <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Job Listings</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">

</head>
<body> {% endcomment %}

    <style>
        .jobcard {
            width: 600px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 16px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            font-family: Arial, sans-serif;
            background-color: #fff;
            margin: 20px;
        }
        .jobcard .jobcard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .jobcard .jobcard-header img {
            width: 50px;
            height: 50px;
            border-radius: 8px;
        }
        .jobcard .jobcard-title {
            font-size: 18px;
            font-weight: bold;
            margin: 0;
        }
        .jobcard .jobcard-subtitle {
            font-size: 14px;
            color: #555;
            margin: 4px 0;
        }
        .jobcard .jobcard-subtitle span {
            color: #f39c12;
        }
        .jobcard .jobcard-body {
            margin-top: 16px;
            font-size: 14px;
            color: #333;
        }
        .jobcard .jobcard-footer {
            margin-top: 16px;
            font-size: 12px;
            color: #777;
        }
        .jobcard .icon {
            margin-right: 8px;
        }
        .jobcard .save {
            color: #007bff;
            cursor: pointer;
        }
        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
            }

            .switch input {
            opacity: 0;
            width: 0;
            height: 0;
            }

            .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            -webkit-transition: .4s;
            transition: .4s;
            }

            .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            -webkit-transition: .4s;
            transition: .4s;
            }

            input:checked + .slider {
            background-color: #2196F3;
            }

            input:focus + .slider {
            box-shadow: 0 0 1px #2196F3;
            }

            input:checked + .slider:before {
            -webkit-transform: translateX(26px);
            -ms-transform: translateX(26px);
            transform: translateX(26px);
            }

            .slider.round {
            border-radius: 34px;
            }

            .slider.round:before {
            border-radius: 50%;
            }
    </style>
    <div class="container mt-5">
        
        <h1>Job Listings</h1>
        
        
        <!-- Button to add a new job -->
        <a href="/company_app/company_job" class="btn btn-success mb-3">Add New Job</a>
        <a href="/company_app/all_job_applications" class="btn btn-success mb-3">View All Applications</a>
        {% for job in job %}
        <a href="{% url 'card_detail' job.id %}">
            <div class="jobcard">

                <div class="jobcard-header">
                    <div>
                        <p class="jobcard-title">{{job.job_title}} - {{job.job_location}}</p>
                        <p class="jobcard-subtitle">2coms <span>‚òÖ 3.8</span> | 446 Reviews</p>
                    </div>
                     <div class="job_status">
                        <label class="switch">
                            <input type="checkbox" data-job-id="{{ job.id }}" {% if job.job_status == "active" %} checked {% endif %} >
                            <span class="slider round"></span>
                        </label>
                    </div>
                    {% comment %} <img src="logo.png" alt="Company Logo"> {% endcomment %}
                </div>
                <div class="jobcard-body">
                    <p><span class="icon">üìÖ</span>{{ job.job_experience}} <span class="icon">üí∞</span>{{job.job_salary}} <span class="icon">üìç</span>{{job.job_location}}</p>
                    <p><span class="icon">üìÑ</span>Graduate/Post Graduate with industry/domain and network operations experience...</p>
                    <p>service operations ¬∑ service assurance ¬∑ order management ¬∑ consulting ¬∑ customer</p>
                </div>
                <div class="jobcard-footer">
                    <p>1 Day Ago <span class="save">üíæ Save</span></p>
                </div>
                <a href="{% url 'job_applications' job.id %}">View applications</a>
            </div>
        </a>

        {% endfor %}
        <!-- List of existing jobs -->
        {% comment %} <div class="job-list">
            <ul class="list-group">
                <!-- Example job items -->
                <li class="list-group-item">Software Engineer - Develop and maintain software applications.</li>
                <li class="list-group-item">Data Analyst - Analyze data and generate reports.</li>
                <li class="list-group-item">Project Manager - Oversee project timelines and deliverables.</li>
                <!-- Add more job items here -->
            </ul>
        </div> {% endcomment %}
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <script>

        document.addEventListener('DOMContentLoaded', async () => {
                const switches = document.querySelectorAll('.switch input[type="checkbox"]');

                switches.forEach(toggleSwitch => {
                    toggleSwitch.addEventListener('change', (event) => {
                        const jobId = event.target.dataset.jobId;
                        const btnStatus = event.target.checked;
                        const newStatus = btnStatus? "active" : "inactive";

                        fetch(`/company_app/update_job_status/${jobId}/`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'X-CSRFToken': '{{ csrf_token }}'
                            },
                            body: JSON.stringify({ status: newStatus })
                        })
                        .then(response => response.json())
                        .then(success => {
                            console.log(success);
                            if (!success) {
                                // If the update fails, revert the switch state
                                event.target.checked = !btnStatus;
                                alert('Failed to update job status.');
                            }
                        })
                        .catch(error => {
                            console.error('Error:', error);
                            // Revert the switch state on network error
                            event.target.checked = !newStatus;
                            alert('An error occurred.');
                        });
                    });
                });
            });
    </script>
{% comment %} </body>
</html> {% endcomment %}
{% endblock %}
